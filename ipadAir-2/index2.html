<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" href="reset.css">
        <link rel="stylesheet" href="style.css">
        <title>iPad Air</title>
    </head>
    <body>
        <div class="container">
            <div class="row row-cols-1 row-cols-md-2">
                <div class="col">
                    <div class="product-img">
                        <img class="w-100" src="./images/defaultImg.jpeg" alt="">
                    </div>
                </div>
                <div class="col pt-5 accordion" id="accordion">

                    <!-- 選擇前：wrap、選擇後：wrap-selected -->
                    <div class="color wrap accordion-item" id="color">
                        <p class="option-title accordion-header d-flex" id="panelsStayOpen-headingOne">
                            <button class="accordion-button collapsed">
                                外觀
                                <button class="btn-edit" type="button" aria-expanded="true"  data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-controls="panelsStayOpen-collapseOne">更改</button>
                            </button>
                        </p>
                        <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordion">
                            <div class="options d-flex flex-wrap accordion-body">
                                <!-- template -->
                                <template id="colorCardTemplate">
                                    <input type="radio" name="options" id="" autocomplete="off" class="btn-check" data-spec="" data-product-img="">
                                    <label for="" class="options-card btn d-flex flex-column justify-content-center align-items-center">
                                        <img src="" class="color-demo-img">
                                        <p class="info-txt"></p>
                                    </label>
                                </template>
                            </div>
                        </div>
                    </div>

                    <div class="storage wrap accordion-item" id="storage">
                        <p class="option-title accordion-header d-flex" id="panelsStayOpen-headingTwo">
                            <button class="accordion-button collapsed">
                                儲存裝置
                                <button class="btn-edit" type="button" aria-expanded="true"  data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-controls="panelsStayOpen-collapseTwo">更改</button>
                            </button>
                        </p>
                        <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingTwo" data-bs-parent="#accordion">
                            <p class="option-description">提前為日後預留空間。你的 iPad 儲存空間愈大，你就有愈多空間儲存數位內容，滿足現在和未來所需。</p>
                            <div class="options d-flex flex-wrap accordion-body">
                                <!-- template -->
                                <template id="storageCardTemplate">
                                    <input type="radio" name="options" id="" autocomplete="off" class="btn-check" data-spec="">
                                    <label for="" class="options-card btn d-flex flex-column justify-content-center align-items-center">
                                        <p class="title"></p>
                                        <p class="info-txt"></p>
                                    </label>
                                </template>
                            </div>
                        </div>
                    </div>

                    <div class="network wrap accordion-item" id="network">
                        <p class="option-title accordion-header d-flex" id="panelsStayOpen-headingThree">
                            <button class="accordion-button collapsed">
                                連線能力
                                <button class="btn-edit" type="button" aria-expanded="true"  data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-controls="panelsStayOpen-collapseThree">更改</button>
                            </button>
                        </p>
                        <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingThree" data-bs-parent="#accordion">
                            <p class="option-description">兩種快速的方式，讓你時時保持聯繫。每部 iPad 都可連接到 Wi-Fi 網路。Wi-Fi + 行動網路機型則讓你在無法使用 Wi-Fi 時，也能連上線。</p>
                            <div class="options d-flex flex-wrap accordion-body">
                                <!-- template -->
                                <template id="networkCardTemplate">
                                    <input type="radio" name="options" id="" autocomplete="off" class="btn-check" data-spec="">
                                    <label for="" class="options-card btn d-flex flex-column justify-content-center align-items-center">
                                        <p class="title"></p>
                                        <p class="info-txt"></p>
                                    </label>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="price-area disable">
                        <p class="result-price">NT 18,900 起</p>
                        <div class="discount-plan">
                            <p class="title">加入換購方案</p>
                            <div class="description d-flex">
                                <p class="info">Apple Trade In 換購方案
                                    透過「Apple Trade In 換購方案」，以你符合條件的平板電腦換購，獲享折抵退款。你也可選擇免額外付費回收**。</p>
                                <a href="" class="see-more">開始進行</a>
                            </div>
                        </div>
                        <a href="" class="next">繼續</a>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <script>
            let colorSelect = '太空灰色';
            let storageSelect = '64GB';
            let networkSelect = 'Wi-Fi';
            let selectArray = [];

        </script>
        <script type="module">
            import {data} from './ipadAir2.js';
            import {create, select} from './functions.js';

            window.onload = () => {

                getSpecCards();

                // 點擊外觀卡片會換大圖
                let colorCardArray = select('#color').querySelectorAll('.options>input');
                colorCardArray.forEach(card => {
                    card.addEventListener('change', function(){
                        select('.product-img>img').src = this.dataset.productImg;
                        
                    })
                })
                
                // filter
                let cardArray = select('.options>input');
                let price = select('.price');
                let wifiPrice = price[2];
                let cellularPrice = price[3];
                let totalPrice = select('.result-price');


                cardArray.forEach(card => {
                    card.addEventListener('change', function(){
                        if(this.dataset.category == 'color'){
                            colorSelect = this.dataset.spec;
                            selectArray = data.productList.filter(x => x.colorName == colorSelect && x.storage == storageSelect && x.network == networkSelect);

                        }else if(this.dataset.category == 'storage'){
                            storageSelect = this.dataset.spec;
                            selectArray = data.productList.filter(x => x.colorName == colorSelect && x.storage == storageSelect && x.network == networkSelect);
                            wifiPrice.innerText = `NT ${selectArray[0].price} 起`;
                            cellularPrice.innerText = `NT ${selectArray[0].price + 4300} 起`;
                        }else{
                            networkSelect = this.dataset.spec;
                            selectArray = data.productList.filter(x => x.colorName == colorSelect && x.storage == storageSelect && x.network == networkSelect);
                            totalPrice.innerText = `NT ${selectArray[0].price} 起`;
                        }
                    })
                })
            }

            // 載入所有規格卡片
            function getSpecCards(){
                let specList = data.spec;

                specList.forEach(spec => {

                    let wrap = select(`#${spec.specName}`);
                    let optionsArea = wrap.querySelector('.options');

                    spec.specList.forEach((item, idx) => {

                        let obj = data.productList.find(x => x.colorName == item || x.storage == item || x.network == item);
                        let cloneCard = select(`#${spec.specName}CardTemplate`).content.cloneNode(true);

                        let input = cloneCard.querySelector('input');
                        let label = cloneCard.querySelector('label');
                        let colorImg = cloneCard.querySelector('img');
                        let title = cloneCard.querySelector('.title');
                        let info = cloneCard.querySelector('.info-txt');

                        input.setAttribute('id', `${spec.specName}-${item}-${idx}`);
                        label.setAttribute('for', `${spec.specName}-${item}-${idx}`);
                        input.setAttribute('data-spec', item);
                        input.setAttribute('data-category', spec.specName);

                        if(spec.specName == 'color'){
                            input.setAttribute('data-product-img', `${obj.picture}`);
                            colorImg.src = obj.colorImg;
                            info.innerText = item
                        }else{
                            title.innerText = item;
                            info.innerText = `NT ${obj.price} 起`;
                            info.classList.add('price');
                        }
                        
                        optionsArea.append(cloneCard);
                    })
                });
            }
        </script>
    </body>
</html>